{% extends "base/base_table.html" %}{{""}} {% block title %}Account Control
{{""}} {% endblock %} {% block javascript %}
<script>
  function addUser(event) {
    // event.preventDefault(); // 防止預設行為
    let button = $(event.target);
    let url = button.attr("url");

    // 向後端發送 AJAX 請求
    $.ajax({
      url: url,
      method: "GET",
      success: function (data) {
        $("#modalContainer").html(data);
        $("#createModal").modal("show");
      },
      error: function (error) {
        console.error("Error loading modal content: ", error);
      },
    });
  }

  function upload() {
    // Define the upload function
  }

  function editRow(link, id) {
    // 轉換姓名欄位
    var nameCell = $("#name-" + id);
    var currentName = nameCell.text();
    nameCell.html(
      '<input type="text" id="edit-name-' +
        id +
        '" value="' +
        currentName +
        '">'
    );

    // 轉換單位欄位
    var unitCell = $("#unit-" + id);
    var currentUnit = unitCell.text();
    unitCell.html(
      '<input type="text" id="edit-unit-' +
        id +
        '" value="' +
        currentUnit +
        '">'
    );

    // 轉換權限欄位
    var permissionCell = $("#permission-" + id);
    var currentPermission = permissionCell.text();
    permissionCell.html(
      '<input type="text" id="edit-permission-' +
        id +
        '" value="' +
        currentPermission +
        '">'
    );

    // 更新編輯鏈接以保存變更
    $(link)
      .text("保存")
      .attr("onclick", "saveRow(this, " + id + ")");
  }

  function saveRow(link, id) {
    // 提取編輯後的值
    var newName = $("#edit-name-" + id).val();
    var newUnit = $("#edit-unit-" + id).val();
    var newPermission = $("#edit-permission-" + id).val();
    var account = $("#account-" + id).text();

    // 更新介面上的文字並恢復原來的編輯鏈接
    $("#name-" + id).text(newName);
    $("#unit-" + id).text(newUnit);
    $("#permission-" + id).text(newPermission);
    $(link)
      .text("編輯")
      .attr("onclick", "editRow(this, " + id + ")");
    $.ajax({
      url: "/account/edit/",
      method: "GET",
      data: {
        account: account,
        username: newName,
        unit: newUnit,
        permission: newPermission,
      },
      success: function (data) {
        window.alert("儲存成功");
      },
    });
  }
</script>
{% endblock %} {% block form %}
<!-- Corrected form tag and added trailing slash to action attribute -->
<form id="search" action="/account/list/" method="GET">
  {% csrf_token %}
  <p>
    <label for="search_username_zh">帳號:</label>
    <input
      type="text"
      id="search_username_zh"
      name="search_username_zh"
      value="{{ username_zh }}"
    />
    <label for="search_unit">所屬單位:</label>
    <input type="text" id="search_unit" name="search_unit" value="{{ unit }}" />
    <label for="search_group">群組:</label>
    <input
      type="text"
      id="search_group"
      name="search_group"
      value="{{ group }}"
    />
  </p>
  <input type="submit" value="查詢" />
  <button type="button" id="upload" onclick="upload()">上傳EXCEL</button>
  <button type="button" url="/account/add/" onclick="addUser(event)">
    新增
  </button>
</form>
{% endblock %} {% block table %}
<caption>
  帳號
</caption>
<thead>
  <tr>
    <th scope="col">帳號</th>
    <th scope="col">姓名</th>
    <th scope="col">所屬單位</th>
    <th scope="col">權限</th>
    <th scope="col">編輯</th>
  </tr>
</thead>
<tbody>
  <!-- Corrected the template variables with double curly braces -->
  {% for info in musers %}
  <tr>
    <td id="account-{{ info.id }}">{{ info.username }}</td>
    <td id="name-{{ info.id }}">{{ info.userName_zh|default:"" }}</td>
    <td id="unit-{{ info.id }}">{{ info.unit|default:"" }}</td>
    <td id="permission-{{ info.id }}">{{ info.group|default:"" }}</td>
    <td id="edit-{{ info.id }}">
      <a href="#" onclick="editRow(this, {{ info.id }})">編輯</a>
    </td>
  </tr>
  {% endfor %}
</tbody>
<div id="modalContainer"></div>
{% endblock %}
